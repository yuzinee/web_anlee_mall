<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="manageProductInsertDAO">
    <!-- 대분류 카테고리 조회 -->
    <select id="selectCategory1" resultType="Map" parameterType="String">
        SELECT *
		FROM TB_PRODUCT_TYPE
		WHERE TYPE_LVL = 1
    </select>
    
    <!-- 중분류 카테고리 조회 -->
    <select id="selectCategory23" resultType="Map" parameterType="String">
        SELECT *
		FROM TB_PRODUCT_TYPE
		WHERE TYPE_SN REGEXP CONCAT('^', #{typeSn}, '_[0-9]+$')
    </select>
    
    <!-- 소분류 카테고리 조회 -->
    <select id="selectCategory3" resultType="Map" parameterType="String">
        SELECT *
		FROM TB_PRODUCT_TYPE
		WHERE TYPE_SN REGEXP CONCAT('^', #{typeSn}, '_[0-9]+$')
    </select>
    
    <insert id="insertProduct">
    	INSERT INTO TB_PRODUCT 
	    (
	        PRDCT_SN 
	      , TYPE_SN 
	      , PRDCT_NM 
	      , PRDCT_DTLS 
	      , PRDCT_PRCS 
	      , PRDCT_STK
	      , DISC_AMNT
	      , DISC_PER 
	      , USE_YN 
	      , REG_DT
	      , REG_ID
	    ) 
	    SELECT 
	        IFNULL(MAX_PRDCT_SN, 0) + 1
	      , #{param[sbx_category3]}
	      , #{param[inp_name]}
	      , #{param[inp_detail]}
	      , #{param[inp_price]}
	      , #{param[inp_inventory]}
	      <if test="param[sbx_discount] == '0'">
	          , #{param[inp_discount]} 
	          , 0 
	      </if>
	      <if test="param[sbx_discount] == '1'">
	          , 0 
	          , #{param[inp_discount]}
	      </if>
	      <if test="param[sbx_discount] == 'N'">
	          , 0 
	          , 0
	      </if>
	      , "Y"
	      , sysdate()
	      , #{userId}
	    FROM (SELECT MAX(PRDCT_SN) AS MAX_PRDCT_SN FROM TB_PRODUCT) AS subquery
    </insert>
</mapper>